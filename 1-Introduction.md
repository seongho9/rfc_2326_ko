# RFC 2326 : RTSP 1.0

# Intro

## Purpose

시간에 동기적인 오디오나 비디오 같은 연속적인 스트림의 전송에서 세션을 생성하거나 조작하는 역할을 수행

RTSP 프로토콜 자체가 데이터를 전송하지 않으며, 단지 네트워크를 통한 조작(network remote control)을 수행

해당 데이터를 전송하는 프로토콜에 의존적이지 않으나 보통 RTP프로토콜을 사용

HTTP/1.1과 유사한 문법과 동작을 수행하지만 다른점이 존재

- HTTP/1.1과의 차이점

  - 몇몇 메서드가 추가되었음
  - 상태를 유지함(statness)
  - RTSP 서버와 클라이언트는 둘 다 요청을 생성 할 수 있음
  - 데이터는 다른 프로토콜에 의해 out-of-band 방식으로 전송됨
  - RTSP는 ISO 10646(UTF-8) 방식으로 인코딩됨
  - 요청-URI는 URI의 절대경로만을 포함(HTTP/1.1과 같이 별도의 Host를 확인안해도됨)


다음과 같은 동작을 지원함

- 미디어 서버에서의 미디어 검색

  미디어에 대한 설명을 HTTP나 다른 방법으로 요청 할 수 있음

- 미디어 서버는 회의에 초대 될 수 있음

  미디어서버는 기존 회의(conference)에 초대(invited)될 수 있음

  여기에서 미디어를 재생하거나 녹화할 수 있음

- 기존 프레젠테이션에 미디어 추가

  서버에 클라이언트가 추가적인 미디어를 사용할 수 있음

## Terminology

- Aggregate Control

  여러 스트림을 하나의 시간으로 조작 할 수 있다.

  즉, 사용자는 play 혹은 pause 요청 하나로 오디오와 비디오 데이터를 동시에 제어 할 수 있다.

- Conference

  멀티미디어의 표현으로 여기에서 멀티는 1개 이상을 의미함

  다양한 미디어 스트림과 참여자 간의 실시간 상호작용을 하는 세션을 의미

- Client

  미디어 서버에 연속적은 미디어 데이터를 요청하는 주체

- Connection

  전송계층에서의 가상 회선연결을 의미함. 즉 통신을 위해 수행하는 연결을 의미함

- Container file

  여러 종류의 미디어 스트림을 포함하는 파일로 이 때, 미디어 스트림은 모두 같이 수행된다.

  RTSP 서버는 이 파일들의 Aggregate Control을 수행해야 한다.

- Continuous media

  시간에 의존적인 데이터로 실시간성의 가지는 데이터이다

- Entity

  요청과 응답에 대하여 payload에 실리는 데이터

  메타정보는 Entity-header에 내용은 Entity-Body에 실린다

- Media initialization

  데이터 타입 이나 코덱에 의존적인 부분으로 clock rate, 색상정보 등을 초기화 한다.

  전송에 무관한 정보들을 초기화

- Media parameter

  미디어 타입에 대한 자세한 정보로 스트림이의 재생 이전 혹은 재생 중에 초기화

- Media server

  1개 이상의 미디어스트림을  재생 혹은 녹화하는 서버

  출력되는 미디어 정보는 1개 이상의 서버에서 제공 될 수 있다

- Media server indriection

  클라이언트에서 다양한 미디어 서버로의 redirection

- Message

  RTSP 통신에서의 기본단위

  구조화된 순서의 옥텟으로 구성

- Participant

  Conference에 참여한 맴버로 여기에서 맴버는 녹화 혹은 재생하는 서버일 가능성이 큼

- Presentation

  완벽한 미디어의 형태로 재생되는 1개이상의 스트림

- Presentation Description

  표현하기 위한 미디어 정보를 의미하며 보통 SDP로 표현함

## Extending RTSP

모든 미디어 서버는 같은 기능을 가지고 있지 않다.

예를 들면,

- 서버 A는 재생만 가능하며, 녹화요청은 필요로 하지 않는다
- 서버 B는 절대적인 위치의 탐색이 불가능하며, 이 말인 즉 라이브 이벤트만 처리가능하다.
- 서버 C는 스트림 파라미터를 세팅을 지원하지 않는다 즉 `GET_PARAMETER`와 `SET_PARAMETER`를 지원하지 않는다

이러한 확장가능성을 위해각기 서버는 모든 헤더의 필드를 구현해야 한다.

RTSP서버는 3가지 방법으로 확장이 가능하다

1. 기존 메서드에 새 매개변수 추가

   기존 메서드에 새로운 매개변수를 확장 할 수 있으며, 수신 측에서 해당 매개변수는 무시 될 수 있다.

   만약 해당 파라미터가 지원하지 않는 경우 이를 알려면 확자엥 해당하는 태그를 `Require`필드에 추가 할 수 있다

2. 새 메서드 추가

   새로운 메서드를 추가 할 수 있으며, 수신자가 해석이 불가능하면 501 에러(Not implemented)를 반환한다.

   `OPTIONS` 메서드를 사용해 서버가 지원하는 메서드를 알 수 있으며, 서버는 `Public` 응답 헤더를 사용하여 지원하는 메서드를 나열해야 한다

3. 프로토콜 버전 정의

   새로운 프로토콜버전을 정의 할 수 있다.

## Overall Operation

각 Presentation과 미디어 스트림은 RTSP URL에 의해 구분된다.

이러한 presetation과 미디어에 대한 정보는 Present description file에 의해 정의되며, 해당 내용은 RTSP 문서의 범위를 벗어난다.

HTTP나 email을 통해 알 수 있으며 미디어 서버에 별도로 저장할 필요는 없다

Presentation Description 파일은 인코딩, 언어 등과 같은 미디어 스트림을 재생하기 위한 정보 등을 포함한다.

각 미디어 스트림은 다양한 방식으로 존재할 수 있으며 다음과 같다.

- Unicast

  미디어는 클라이언트로 전송되며 클라이언트가 전송포트를 선택한다.

  이 때, 미디어는 신뢰 할 수 있는 스트림으로 전송 된다

- Multicast, server chooses address

  미디어 서버가 멀티케스트 주소와 포트를 설정하며, 이는 라이브 또는 near-on-demand 전송에 사용된다

- Multicast, client chooses address

  서버가 기존의 multicate conference에 참여해야 하는경우에 해당하며, 멀티케스트 주소 및 포트와 암호화 키는 정보가 제공된다

## RTSP States

RTSP 프로토콜은 TCP 연결에 의해 발생되며, 데이터는 UDP를 통해 전송된다.

따라서 별도의 RTSP 요청이 미디어서버에 없더라도 데이터는 지속적으로 전달된다.

따라서 서버는 세션의 상태를 해당하는 RTSP 요청에 맞게 유지해야 한다.

다음 메서드가 상태의 변경에 영향을 끼친다

- `SETUP`

  RTSP세션 시작에 있어 서버 자원을 할당한다

- `PLAY` & `RECORD`

  `SETUP`으로 할당된 데이터를 전송하기 시작

- `PAUSE`

  자원을 반납하지 않고 임시적으로 스트림을 멈춘다

- `TEARDOWN`

  할당받은 자원을 반납하며, RTSP 세션을 종료 한다.

## Relationship with Other Protocols

RTSP는 기능적으로 HTTP와 겹치는 부분이 많으며 초기 연결에 있어 HTTP 통해 지원하는 경우가 많은데 이경우 Web 페이지를 통해 세션이 생성되는 경우에 해당한다.

하지만 RTSP는 상태를 유지하는 방식으로 동작하며, 다른 프로토콜에 의해 Out-Of-Band형식으로 데이터가 전송된다.

HTTP 프로토콜을 재사용하며, 보안과 프록시에 이점을 가져왔으며 필요한 것도 매우 비슷하다.
